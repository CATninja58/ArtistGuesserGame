<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist Guesser Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* General body styles */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background-color: #121212;
            color: #f4f4f4;
        }

        h1 {
            margin-top: 20px;
            color: #f4f4f4;
        }

        input {
            margin-top: 20px;
            padding: 10px;
            font-size: 14px;
            width: 300px;
            background-color: #1c1c1c;
            color: #f4f4f4;
            border: none;
        }

        .button-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 20px;
            height: auto;
        }

        button {
            width: 250px;
            height: 50px;
            font-size: 14px;
            background-color: #1c1c1c;
            color: #f4f4f4;
            border: none;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .green {
            background-color: #159643;
        }

        .orange {
            background-color: #b19600;
        }

        .grey {
            background-color: grey;
        }

        .results-container {
            width: 80%;
            margin-top: 40px;
            padding: 10px;
            border-top: 2px solid #000;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .artist-list-wrapper {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            color: #f4f4f4;
            text-align: left;
            word-wrap: break-word;
        }

        th {
            font-weight: bold;
        }

        .footer-text {
            font-weight: bold;
            margin-top: 20px;
            color: #f4f4f4;
        }

        @media (max-width: 800px) {
            body {
                justify-content: center;
            }

            input {
                width: 90%;
            }

            .results-container {
                width: 100%;
            }

            .button-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 2px;
                justify-items: center;
                width: 100%;
            }

            button {
                width: 90%;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <h1>Artist Guesser Game</h1>

    <input type="text" id="artistSearch" placeholder="Enter artist name" oninput="searchArtist()">
    <div id="searchResults"></div>

    <div id="guessesContainer" class="guess-container" style="margin-top: 40px; margin-bottom: 20px; gap: 20px;">
        <!-- Guesses will be dynamically added here -->
    </div>

    <div class="results-container">
        <div class="footer-text" style="font-size: 16px;">List of possible artists</div>
        <div class="artist-list-wrapper">
            <table>
                <thead>
                    <tr>
                        <th style="min-width: 300px;">Artist</th>
                        <th style="min-width: 200px;">Debut</th>
                        <th style="min-width: 250px;">Popularity</th>
                        <th style="min-width: 200px;">Members</th>
                        <th style="min-width: 200px;">Genre</th>
                        <th style="min-width: 200px;">Country</th>
                        <th style="min-width: 200px;">Gender</th>
                    </tr>
                </thead>
                <tbody id="artistList"></tbody>
            </table>
        </div>
    </div>
    <div class="footer-text">Made by u/CATninja58. Soundmap user: jeddosterives</div>

    <script>
        let artistsData = [];
        let correctArtist = null;
        let guesses = [];
        let guessCount = 0;

        function loadCSV() {
            const csvUrl = "https://raw.githubusercontent.com/CATninja58/Soundmapsolver/main/MasterArtistList.csv";
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => parseCSV(csvText))
                .catch(error => console.error("Error loading CSV file:", error));
        }

        function parseCSV(csvText) {
            const rows = csvText.split("\n");
            rows.shift();
            artistsData = rows.map(row => {
                const [artist, debut, popularity, members, genre, country, gender] = row.split(",");
                return { artist, debut, popularity, members, genre, country, gender };
            });
            correctArtist = artistsData[Math.floor(Math.random() * artistsData.length)];
            displayArtists();
        }

        function searchArtist() {
            const query = document.getElementById("artistSearch").value.toLowerCase();
            const searchResults = document.getElementById("searchResults");
            searchResults.innerHTML = '';

            if (query) {
                const matches = artistsData.filter(artist => artist.artist.toLowerCase().includes(query));
                matches.forEach(match => {
                    const resultDiv = document.createElement("div");
                    resultDiv.textContent = match.artist;
                    resultDiv.onclick = () => {
                        makeGuess(match.artist);
                        document.getElementById("artistSearch").value = '';
                        searchResults.innerHTML = '';
                    };
                    searchResults.appendChild(resultDiv);
                });
            }
        }

        function makeGuess(artistName) {
            const artist = artistsData.find(artist => artist.artist === artistName);
            if (artist) {
                guessCount++;
                const guessesContainer = document.getElementById("guessesContainer");

                const guessTitle = document.createElement("div");
                guessTitle.classList.add("guess-title");
                guessTitle.textContent = `Guess #${guessCount}`;
                guessesContainer.appendChild(guessTitle);

                const artistNameDiv = document.createElement("div");
                artistNameDiv.textContent = artist.artist;
                guessesContainer.appendChild(artistNameDiv);

                const guessBoxes = document.createElement("div");
                guessBoxes.classList.add("button-container");
                guessBoxes.classList.add("guess-boxes");
                guessesContainer.appendChild(guessBoxes);

                const guess = { artist, feedback: {} };
                guesses.push(guess);

                provideFeedback(artist, guessBoxes, guess);
            }
        }

        function provideFeedback(artist, container, guess) {
            const categories = ["debut", "popularity", "members", "genre", "country", "gender"];
            categories.forEach(category => {
                const button = document.createElement("button");
                const feedback = getFeedback(category, artist[category], correctArtist[category]);
                guess.feedback[category] = feedback;
                button.innerHTML = `<span class="button-text">${category.charAt(0).toUpperCase() + category.slice(1)}: ${artist[category]}</span><br><span class="button-text">(${feedback})</span>`;
                button.className = getFeedbackColor(feedback);
                container.appendChild(button);
            });

            if (artist.artist === correctArtist.artist) {
                alert("Congratulations! You've guessed the correct artist!");
            }
        }

        function getFeedback(category, guessValue, correctValue) {
            if (category === 'debut') {
                const guessYear = parseInt(guessValue);
                const correctYear = parseInt(correctValue);
                const diff = Math.abs(guessYear - correctYear);
                if (diff === 0) return 'correct';
                if (diff <= 5) return guessYear > correctYear ? 'close v' : 'close ^';
                return guessYear > correctYear ? 'later ^' : 'earlier v';
            } else if (category === 'popularity') {
                const guessPop = parseInt(guessValue);
                const correctPop = parseInt(correctValue);
                const diff = Math.abs(guessPop - correctPop);
                if (diff === 0) return 'correct';
                if (diff <= 50) return guessPop > correctPop ? 'close v' : 'close ^';
                return guessPop > correctPop ? 'lower v' : 'higher ^';
            } else if (category === 'country') {
                if (guessValue === correctValue) return 'correct';
                const guessContinent = getContinent(guessValue);
                const correctContinent = getContinent(correctValue);
                if (guessContinent === correctContinent) return 'close';
                return 'wrong';
            } else {
                return guessValue === correctValue ? 'correct' : 'wrong';
            }
        }

        function getContinent(countryCode) {
            const continentMap = {
                'NA': ['US', 'CA', 'MX', 'GT', 'HN', 'SV', 'NI', 'CR', 'PA', 'BS', 'CU', 'HT', 'DO', 'JM', 'TT', 'BB', 'LC', 'VC', 'GD', 'AG', 'DM', 'KN'],
                'SA': ['BR', 'AR', 'CL', 'CO', 'VE', 'PE', 'BO', 'PY', 'UY', 'GY', 'SR', 'EC'],
                'EU': ['UK', 'FR', 'DE', 'IT', 'ES', 'PL', 'RO', 'NL', 'BE', 'GR', 'CZ', 'PT', 'HU', 'SE', 'AT', 'CH', 'BG', 'DK', 'FI', 'SK', 'NO', 'IE', 'HR', 'SI', 'LV', 'EE', 'CY', 'LU', 'MT', 'IS', 'LI', 'MC', 'SM', 'VA', 'RU', 'UA', 'BY', 'MD', 'BA', 'ME', 'MK', 'AL', 'RS', 'XK'],
                'AS': ['CN', 'JP', 'IN', 'ID', 'PK', 'BD', 'PH', 'VN', 'TR', 'IR', 'TH', 'MM', 'KR', 'IQ', 'SA', 'UZ', 'MY', 'YE', 'NP', 'LK', 'KZ', 'SY', 'KH', 'JO', 'AZ', 'AE', 'IL', 'TJ', 'LA', 'LB', 'KG', 'TM', 'SG', 'OM', 'KW', 'GE', 'MN', 'AM', 'QA', 'BH', 'BT', 'MV', 'BN'],
                'AF': ['ZA', 'NG', 'EG', 'DZ', 'MA', 'ET', 'TZ', 'KE', 'UG', 'SD', 'GH', 'CM', 'CI', 'ML', 'BF', 'NE', 'MW', 'ZM', 'SN', 'ZW', 'TD', 'SO', 'GN', 'RW', 'BI', 'BJ', 'SL', 'TG', 'SS', 'LY', 'LR', 'MR', 'GA', 'GM', 'GW', 'LS', 'SZ', 'KM', 'CV', 'ST', 'SC', 'DJ', 'ER'],
                'OC': ['AU', 'NZ', 'FJ', 'PG', 'SB', 'VU', 'NC', 'PF', 'WS', 'KI', 'TO', 'TV', 'NR', 'FM', 'MH', 'PW']
            };
            for (const continent in continentMap) {
                if (continentMap[continent].includes(countryCode)) {
                    return continent;
                }
            }
            return '';
        }

        function getFeedbackColor(feedback) {
            if (feedback === 'correct') return 'green';
            if (feedback.includes('close')) return 'orange';
            return 'grey';
        }

        function displayArtists() {
            const artistList = document.getElementById("artistList");
            artistList.innerHTML = '';

            artistsData.forEach(artist => {
                const artistItem = document.createElement("tr");
                artistItem.innerHTML = `
                    <td>${artist.artist}</td>
                    <td>${artist.debut}</td>
                    <td>${artist.popularity}</td>
                    <td>${artist.members}</td>
                    <td>${artist.genre}</td>
                    <td>${artist.country}</td>
                    <td>${artist.gender}</td>
                `;
                artistList.appendChild(artistItem);
            });
        }

        loadCSV();
    </script>
</body>
</html>
